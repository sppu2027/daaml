# ðŸ§© Block 1: Import libraries and read dataset
import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv('Mall_Customers.csv')
df.head()


# ðŸ§© Block 2: Prepare data
x = df.iloc[:, 3:]
x


# ðŸ§© Block 3: Plot unclustered data
plt.title('Unclustered Data')
plt.xlabel('Annual Income')
plt.ylabel('Spending Score')
plt.scatter(x['Annual Income (k$)'], x['Spending Score (1-100)'])


# ðŸ§© Block 4: Apply K-Means Clustering
from sklearn.cluster import KMeans, AgglomerativeClustering

km = KMeans(n_clusters=3)
x.shape
km.fit_predict(x)
km.inertia_


# ðŸ§© Block 5: Elbow Method
sse = []
for k in range(1, 16):
    km = KMeans(n_clusters=k)
    km.fit_predict(x)
    sse.append(km.inertia_)

plt.title('Elbow Method')
plt.xlabel('Value of k')
plt.ylabel('SSE')
plt.grid()
plt.xticks(range(1, 16))
plt.plot(range(1, 16), sse, marker='.')


# ðŸ§© Block 6: Silhouette Method
from sklearn.metrics import silhouette_score

silh = []
for k in range(2, 16):
    km = KMeans(n_clusters=k)
    labels = km.fit_predict(x)
    score = silhouette_score(x, labels)
    silh.append(score)

plt.title('Silhouette Method')
plt.xlabel('Value of k')
plt.ylabel('Silhouette Score')
plt.grid()
plt.xticks(range(2, 16))
plt.bar(range(2, 16), silh)


# ðŸ§© Block 7: Final Clustering and Visualization
kmeans = KMeans(n_clusters=5, random_state=0)
labels = kmeans.fit_predict(x)
cent = kmeans.cluster_centers_

plt.subplot(1, 2, 1)
plt.title('Unclustered Data')
plt.xlabel('Annual Income')
plt.ylabel('Spending Score')
plt.scatter(x['Annual Income (k$)'], x['Spending Score (1-100)'], marker='.')

plt.subplot(1, 2, 2)
plt.title('Clustered Data')
plt.xlabel('Annual Income')
plt.ylabel('Spending Score')
plt.scatter(x['Annual Income (k$)'], x['Spending Score (1-100)'], c=labels, marker='.')
